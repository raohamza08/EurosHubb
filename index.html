<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EurosHub - Project Tracking Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

  <div class="max-w-4xl mx-auto mt-10 bg-white p-8 rounded shadow-lg">
    <div class="text-center mb-8">
      <img src="https://via.placeholder.com/150x50?text=EUROSHUB" alt="EurosHub Logo" class="mx-auto mb-2">
      <h2 class="text-2xl font-bold">EurosHub - Project Tracking Intake Form</h2>
    </div>

    <form id="projectForm" class="space-y-6">
      <div>
        <label class="block font-medium">Email *</label>
        <input type="email" name="email" required class="w-full border rounded px-3 py-2 mt-1" />
      </div>
      <div>
        <label class="block font-medium">Profile Name *</label>
        <select name="profileName" required class="w-full border rounded px-3 py-2 mt-1">
          <option value="">Choose</option><option>Asif</option><option>Kainat</option><option>Laiba</option><option>Saira</option>
          <option>Waqar</option><option>Nabeel</option><option>Syeda</option><option>Zain</option>
        </select>
      </div>
      <div>
        <label class="block font-medium">Project Tracking Time (Hours:Minutes)</label>
        <input type="text" name="trackingTime" placeholder="e.g. 7:30" class="w-full border rounded px-3 py-2 mt-1" />
      </div>
      <div>
        <label class="block font-medium">Memo</label>
        <textarea name="memo" rows="3" placeholder="Project Name & Memo if Manual Time" class="w-full border rounded px-3 py-2 mt-1"></textarea>
      </div>
      <div>
        <label class="block font-medium">Tracking Date *</label>
        <input type="date" name="trackingDate" required class="w-full border rounded px-3 py-2 mt-1" />
      </div>
      <div>
        <label class="block font-medium">Project Tracking Start Time *</label>
        <input type="time" name="startTime" required class="w-full border rounded px-3 py-2 mt-1" />
      </div>
      <div>
        <label class="block font-medium">Project Tracking End Time *</label>
        <input type="time" name="endTime" required class="w-full border rounded px-3 py-2 mt-1" />
      </div>
      <div>
        <label class="block font-medium">Team Member Name *</label>
        <select name="teamMember" required class="w-full border rounded px-3 py-2 mt-1">
          <option value="">Choose</option>
          <option>Ahmad Ali</option><option>Ahsan Munir</option><option>Ali Rayyan</option><option>Hamza Badar</option>
          <option>Hamza Ikram</option><option>Mahnoor Manzoor</option><option>Mohsin Ali</option><option>Muhammad Bilal</option>
          <option>Muhammad Uzaam Liaqat</option><option>Shahroze Shahid</option><option>Syeda Alina Zahra</option>
          <option>Tabassum Munir</option><option>Zainab</option><option>Zohaib Tasaddaq</option><option>Hammad Amir</option>
          <option>Muhammad Usman</option><option>Fatima Hafeez</option>
        </select>
      </div>

      <div id="splitResult" class="hidden mt-6">
        <h3 class="font-bold mb-2">Time Entries to be Submitted:</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border">
            <thead>
              <tr class="bg-gray-200">
                <th class="py-2 px-4 border">Email</th>
                <th class="py-2 px-4 border">Profile</th>
                <th class="py-2 px-4 border">Time</th>
                <th class="py-2 px-4 border">Memo</th>
                <th class="py-2 px-4 border">Original Date</th>
                <th class="py-2 px-4 border">Start</th>
                <th class="py-2 px-4 border">End</th>
                <th class="py-2 px-4 border">Member</th>
                <th class="py-2 px-4 border">Split Date</th>
                <th class="py-2 px-4 border">From</th>
                <th class="py-2 px-4 border">To</th>
              </tr>
            </thead>
            <tbody id="splitEntriesBody"></tbody>
          </table>
        </div>
      </div>

      <div class="text-center">
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Submit</button>
      </div>
    </form>

    <p id="thankYouMsg" class="hidden text-green-600 font-semibold text-center mt-4">âœ… Submitted successfully!</p>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxhB2RHx459CgCcfk6as1Tf3Q5_Np-iGQ-vJH_CcymGQWntsppyWydW3wiuE0zkrh9W1g/exec"; 
    const form = document.getElementById("projectForm");

    function splitTimeAcrossDates(userId, startDate, startTime, endTime) {
      const result = [];
      const startDateTime = new Date(startDate + 'T' + startTime);
      let endDateTime = new Date(startDate + 'T' + endTime);

      if (endDateTime <= startDateTime) {
        endDateTime.setDate(endDateTime.getDate() + 1);
      }

      const currentStart = new Date(startDateTime);

      while (startDateTime.toDateString() !== endDateTime.toDateString()) {
        result.push({
          userId: userId,
          date: startDateTime.toISOString().split('T')[0],
          from: currentStart.toTimeString().slice(0, 5),
          to: "23:59"
        });

        startDateTime.setDate(startDateTime.getDate() + 1);
        startDateTime.setHours(0, 0);
        currentStart.setDate(currentStart.getDate() + 1);
        currentStart.setHours(0, 0);
      }

      result.push({
        userId: userId,
        date: startDateTime.toISOString().split('T')[0],
        from: currentStart.toTimeString().slice(0, 5),
        to: endDateTime.toTimeString().slice(0, 5)
      });

      return result;
    }

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting...";

      try {
        const userId = form.teamMember.value;
        const trackingDate = form.trackingDate.value;
        const startTime = form.startTime.value;
        const endTime = form.endTime.value;
        const splitEntries = splitTimeAcrossDates(userId, trackingDate, startTime, endTime);

        // Show preview table
        const tableBody = document.getElementById("splitEntriesBody");
        tableBody.innerHTML = "";
        splitEntries.forEach(entry => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="border px-2 py-1">${form.email.value}</td>
            <td class="border px-2 py-1">${form.profileName.value}</td>
            <td class="border px-2 py-1">${form.trackingTime.value}</td>
            <td class="border px-2 py-1">${form.memo.value}</td>
            <td class="border px-2 py-1">${trackingDate}</td>
            <td class="border px-2 py-1">${startTime}</td>
            <td class="border px-2 py-1">${endTime}</td>
            <td class="border px-2 py-1">${userId}</td>
            <td class="border px-2 py-1">${entry.date}</td>
            <td class="border px-2 py-1">${entry.from}</td>
            <td class="border px-2 py-1">${entry.to}</td>
          `;
          tableBody.appendChild(row);
        });
        document.getElementById("splitResult").classList.remove("hidden");

        for (const entry of splitEntries) {
          const formData = new FormData();
          formData.append("email", form.email.value);
          formData.append("profileName", form.profileName.value);
          formData.append("trackingTime", form.trackingTime.value);
          formData.append("memo", form.memo.value);
          formData.append("originalDate", trackingDate);
          formData.append("startTime", startTime);
          formData.append("endTime", endTime);
          formData.append("teamMember", userId);
          formData.append("splitDate", entry.date);
          formData.append("splitFrom", entry.from);
          formData.append("splitTo", entry.to);

          await fetch(scriptURL, {
            method: "POST",
            body: formData
          });
        }

        document.getElementById("thankYouMsg").classList.remove("hidden");

      } catch (error) {
        console.error('Submission error:', error);
        alert('Error submitting form: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
      }
    });
  </script>
</body>
</html>
